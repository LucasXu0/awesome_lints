# Migration Guide: v2.0.0 to v2.1.0

**Document Version:** 1.0
**Last Updated:** 2025-12-22
**Applies to:** v2.0.0 → v2.1.0
**Author(s):** Lucas

---

## Table of Contents

1. [Breaking Change Overview](#breaking-change-overview)
2. [Impact Assessment](#impact-assessment)
3. [Migration Paths](#migration-paths)
4. [Detailed Migration Examples](#detailed-migration-examples)
5. [Verification](#verification)
6. [Troubleshooting](#troubleshooting)
7. [Rollback Plan](#rollback-plan)
8. [Migration Timeline Recommendation](#migration-timeline-recommendation)
9. [CI/CD Integration](#cicd-integration)
10. [Frequently Asked Questions](#frequently-asked-questions)
11. [Getting Help](#getting-help)
12. [Additional Resources](#additional-resources)

---

## Breaking Change Overview

Version 2.1.0 introduces an opt-in rule model. All lint rules are disabled by default.

## Impact Assessment

### Who is affected?

- All users upgrading from v2.0.0
- CI/CD pipelines expecting specific warnings
- Teams with existing `analysis_options.yaml` configurations

### What breaks?

- Existing configurations without preset inclusion will have ZERO active rules
- Tests expecting specific lint warnings may fail
- CI checks may pass when they shouldn't

### What stays the same?

- All lint rules still exist and function identically
- Rule configurations and options remain unchanged
- Custom lint behavior and reporting unchanged
- IDE integration continues to work as expected
- No changes to rule detection logic

---

## Migration Paths

### Path 1: No Behavior Change (Strict Preset)

**Use case:** Maintain exact v2.0.0 behavior

**Steps:**
1. Update `pubspec.yaml`: `awesome_lints: ^2.1.0`
2. Update `analysis_options.yaml`:
   ```yaml
   include: package:awesome_lints/presets/strict.yaml
   ```
3. Run `dart run custom_lint` - should see same warnings as before

**Effort:** < 5 minutes
**Risk:** Very low

### Path 2: Adopt Recommended Preset

**Use case:** Balanced approach, fewer but valuable rules

**Steps:**
1. Update `pubspec.yaml`: `awesome_lints: ^2.1.0`
2. Update `analysis_options.yaml`:
   ```yaml
   include: package:awesome_lints/presets/recommended.yaml
   ```
3. Run `dart run custom_lint`
4. Address any new warnings (likely fewer than before)
5. Optionally add more rules as needed

**Effort:** 1-2 hours
**Risk:** Low

### Path 3: Gradual Adoption

**Use case:** Learn rules incrementally, minimal disruption

**Steps:**
1. Update `pubspec.yaml`: `awesome_lints: ^2.1.0`
2. Start with core:
   ```yaml
   include: package:awesome_lints/presets/core.yaml
   ```
3. Address core warnings (usually < 20)
4. Gradually enable more rules over weeks/months
5. Eventually reach recommended or custom configuration

**Effort:** Ongoing (low weekly effort)
**Risk:** Very low

---

## Detailed Migration Examples

### Example 1: Simple Project with Default Configuration

**Before (v2.0.0):**
```yaml
# analysis_options.yaml
analyzer:
  plugins:
    - custom_lint

# Result: All 128 rules automatically enabled
```

**After (v2.1.0):**
```yaml
# analysis_options.yaml
analyzer:
  plugins:
    - custom_lint

include: package:awesome_lints/presets/recommended.yaml

# Result: ~40 curated rules enabled
```

**Explanation:**
Adding the preset inclusion line enables a balanced set of rules suitable for most projects without the overwhelming number of warnings from all 128 rules.

---

### Example 2: Project with Custom Rule Disabling

**Before (v2.0.0):**
```yaml
# analysis_options.yaml
analyzer:
  plugins:
    - custom_lint

custom_lint:
  rules:
    - no_magic_number: false
    - no_magic_string: false
    - avoid_barrel_files: false
    # ... 20 more disabled rules
```

**After (v2.1.0):**
```yaml
# analysis_options.yaml
analyzer:
  plugins:
    - custom_lint

include: package:awesome_lints/presets/recommended.yaml

custom_lint:
  rules:
    # Only enable additional rules you want
    - prefer_early_return
    - avoid_late_context
```

**Explanation:**
The new approach is cleaner - start with a reasonable preset and only add what you need, rather than disabling what you don't want.

---

### Example 3: Strict Project Wanting All Rules

**Before (v2.0.0):**
```yaml
# analysis_options.yaml
analyzer:
  plugins:
    - custom_lint

# All rules enabled automatically
```

**After (v2.1.0):**
```yaml
# analysis_options.yaml
analyzer:
  plugins:
    - custom_lint

include: package:awesome_lints/presets/strict.yaml

# All 128 rules enabled - identical behavior
```

**Explanation:**
The strict preset maintains exact v2.0.0 behavior with all rules enabled.

---

## Verification

After migration, verify your configuration works correctly:

```bash
# Step 1: Check package version
dart pub deps | grep awesome_lints
# Expected: awesome_lints 2.1.0

# Step 2: Run analysis
dart run custom_lint

# Step 3: Check which rules are active (verbose mode)
dart run custom_lint --verbose
```

### Expected Results

**Success indicators:**
- Custom lint runs without errors
- Appropriate number of warnings for chosen preset (core: ~5-20, recommended: ~20-50, strict: 100-500+)
- No "unknown rule" or configuration errors
- IDE integration shows lint warnings

**Warning signs:**
- Zero warnings when you expected some (missing preset configuration)
- "Plugin not found" errors (need to run `dart pub get`)
- Hundreds of warnings on a clean codebase (might be using strict unintentionally)

---

## Troubleshooting

### No warnings appearing

**Cause:** Missing preset configuration

**Solution:**
```yaml
# analysis_options.yaml
include: package:awesome_lints/presets/recommended.yaml
```

### Too many warnings after upgrade

**Cause:** Using strict preset with previously disabled rules

**Solution:** Switch to recommended preset or customize:
```yaml
include: package:awesome_lints/presets/recommended.yaml

custom_lint:
  rules:
    - some_noisy_rule: false
```

### CI pipeline failing

**Cause:** No rules enabled, tests expect warnings

**Solution:** Add preset to CI's `analysis_options.yaml`

---

### IDE not showing lint warnings

**Symptom:** VS Code or IntelliJ doesn't show custom lint warnings

**Cause:** IDE cache needs refresh or analysis server restart

**Solution:**
```bash
# For VS Code with Dart extension:
# 1. Open command palette (Cmd/Ctrl+Shift+P)
# 2. Run "Dart: Restart Analysis Server"

# For IntelliJ/Android Studio:
# 1. File > Invalidate Caches / Restart
# 2. Run `dart pub get` again
```

---

## Rollback Plan

If you need to rollback to v2.0.0:

```yaml
# pubspec.yaml
dev_dependencies:
  awesome_lints: ^2.0.0
```

Then remove preset configuration:
```yaml
# analysis_options.yaml
# Remove: include: package:awesome_lints/presets/...
```

---

## Migration Timeline Recommendation

### For Small Projects (< 10,000 lines)

**Day 1:**
- Update `pubspec.yaml` to `awesome_lints: ^2.1.0`
- Add preset to `analysis_options.yaml`
- Run `dart pub get` and `dart run custom_lint`

**Day 2-3:**
- Address any new warnings
- Test in CI/CD pipeline

**Total Time:** 1-3 days

---

### For Medium Projects (10,000 - 100,000 lines)

**Week 1:**
- Update package version
- Choose migration path (strict/recommended/gradual)
- Configure preset in `analysis_options.yaml`

**Week 2:**
- Address warnings incrementally
- Update CI/CD configurations
- Test across team

**Week 3+:**
- Fine-tune rule configuration
- Document team decisions

**Total Time:** 2-3 weeks

---

### For Large Projects (> 100,000 lines)

**Week 1-2:**
- Evaluate current warnings and rule usage
- Choose migration strategy
- Create migration plan

**Week 3-4:**
- Implement preset configuration
- Start with strict to maintain current behavior
- Address critical warnings

**Week 5+:**
- Gradually optimize rule selection
- Migrate to recommended or custom config
- Document final configuration

**Total Time:** 1-2 months

---

## CI/CD Integration

### GitHub Actions

Update your workflow file:

```yaml
# .github/workflows/lint.yml
name: Lint

on: [push, pull_request]

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: subosito/flutter-action@v2
        with:
          flutter-version: 'stable'
      - run: flutter pub get
      - run: dart run custom_lint
```

**Key Change:** Ensure your `analysis_options.yaml` includes a preset configuration.

---

### GitLab CI

Update your `.gitlab-ci.yml`:

```yaml
lint:
  image: cirrusci/flutter:stable
  script:
    - flutter pub get
    - dart run custom_lint
  only:
    - merge_requests
    - main
```

---

### Other CI Systems

For other CI systems, ensure:
1. `awesome_lints: ^2.1.0` is in `pubspec.yaml`
2. `analysis_options.yaml` includes a preset
3. Run `dart pub get` before `dart run custom_lint`

---

## Frequently Asked Questions

### Q: Do I have to migrate immediately?

**A:** No, but it's recommended. You can continue using v2.0.0, but v2.1.0 provides better control and user experience.

---

### Q: Will this break my existing codebase?

**A:** No code changes are required. Only your `analysis_options.yaml` needs updating to include a preset. Your code behavior remains unchanged.

---

### Q: Can I migrate gradually?

**A:** Yes! Use the gradual adoption path (Path 3) - start with the core preset and enable more rules over time as your team learns them.

---

### Q: What happens if I forget to add a preset?

**A:** Custom lint will run successfully but report zero warnings (all rules disabled by default). Add a preset to enable rules.

---

### Q: Can I mix presets?

**A:** Yes! You can include a preset and then override specific rules:

```yaml
include: package:awesome_lints/presets/recommended.yaml

custom_lint:
  rules:
    - no_magic_number  # Enable additional rule
    - avoid_barrel_files: false  # Disable preset rule
```

---

### Q: Which preset should I choose?

**A:**
- **New projects:** Start with `core.yaml` or `recommended.yaml`
- **Existing projects migrating from v2.0.0:** Use `strict.yaml` to maintain current behavior
- **Learning awesome_lints:** Start with `core.yaml` and grow incrementally

---

## Getting Help

If you encounter issues not covered in this guide:

1. **Check the documentation:**
   - [Feature document](../feature/2025-12-22-opt-in-rules-by-default.md)
   - [README](../../README.md)
   - [CLAUDE.md](../../CLAUDE.md)

2. **Search existing issues:**
   - [GitHub Issues](https://github.com/LucasXu0/awesome_lints/issues)

3. **Create a new issue:**
   - Include: awesome_lints version, Flutter/Dart version, `analysis_options.yaml`, error messages
   - Use the bug report template

4. **Review changelog:**
   - [CHANGELOG.md](../../CHANGELOG.md) for detailed release notes

---

## Additional Resources

- [Full feature document](../feature/2025-12-22-opt-in-rules-by-default.md)
- [CHANGELOG](../../CHANGELOG.md)
- [README](../../README.md)
- [Preset documentation](../../lib/presets/)
- [custom_lint package](https://pub.dev/packages/custom_lint)

---

**Document Version:** 1.0
**Last Updated:** 2025-12-22
**Applies to:** v2.0.0 → v2.1.0
**Author(s):** Lucas
